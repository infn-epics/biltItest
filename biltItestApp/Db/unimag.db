# =================================================
# Unimag Interface
# =================================================

# =================================================
# Aliases for current and voltage
# =================================================

alias("$(device):CURRENT_RB","$(device):current_rb")
alias("$(device):VOLTAGE_RB","$(device):voltage_rb")
alias("$(device):CURRENT_SP","$(device):current")
alias("$(device):STATUS_RB","$(device):state_rb")
# alias("$(device):STATUS_SP","$(device):state")

# State setpoint mbbo
record(mbbo, "$(device):state") {
    field(DESC, "State setpoint (OFF/ON/STANDBY/RESET)")
    field(ZRVL, "0")
    field(ZRST, "OFF")
    field(ONVL, "1")
    field(ONST, "ON")
    field(TWVL, "2")
    field(TWST, "STANDBY")
    field(THVL, "3")
    field(THST, "RESET")
    field(FLNK, "$(device):state_sp_to_status")
}

# Map STATE_SP to STATUS_SP
record(calcout, "$(device):state_sp_to_status") {
    field(DESC, "Map STATE_SP to STATUS_SP")
    field(INPA, "$(device):state")
    field(CALC, "A=1?1:(A=0||A=2)?0:0")
    field(OUT, "$(device):STATUS_SP PP")
    field(OOPT, "Every Time")
    field(FLNK, "$(device):state_sp_to_clear")
}

# Map STATE_SP to CLEAR
record(calcout, "$(device):state_sp_to_clear") {
    field(DESC, "Map STATE_SP to CLEAR")
    field(INPA, "$(device):STATE_SP")
    field(CALC, "A=3?1:0")
    field(OUT, "$(device):CLEAR PP")
    field(OOPT, "Every Time")
}
